package ar.edu.ungs.prog2.ticketek;

import java.time.LocalDate;
import java.time.format.DateTimeFormatter;
import java.util.LinkedHashSet;

public class Espectaculo {

	String nombre;
	LinkedHashSet<Funcion> funciones;
	DateTimeFormatter formatter = DateTimeFormatter.ofPattern("dd/MM/yy");

	Espectaculo(String nombre){

		this.nombre = nombre;
		this.funciones = new LinkedHashSet<>();;
	}

	@Override 
	public String toString() {

		StringBuilder info = new StringBuilder();

		for (Funcion funcion : funciones) {
			
			info.append(funcion.toString());
			info.append("\n");
		}
		return info.toString();

	}

	public boolean hayFuncion(String fecha){

		for (Funcion fun : funciones) {
			if (fun.fecha.equals(LocalDate.parse(fecha,formatter)))
				return true;
		}
		return false;
	}

	void agregarFuncion(Funcion funcion) {

		for (Funcion fun : funciones) {
			if (fun.fecha.equals(funcion.fecha) && fun.sede.equals(funcion.sede))
				throw new RuntimeException ("La fecha no esta disponible");
		}
		funciones.add(funcion);
	}

	Sede sedeFuncion(String fecha){

		for (Funcion funcion : funciones) {
			if (funcion.fecha.equals(LocalDate.parse(fecha,formatter))) {
				return funcion.sede;
			}
		}
		return null;
	}

	double precioFuncion(String fecha) {
	    
	    for (Funcion funcion : funciones) {
	        if (funcion.fecha.equals(LocalDate.parse(fecha, formatter))) {
	            return funcion.precioBase;
	        }
	    }

	    throw new RuntimeException("No se encontr贸 funci贸n para la fecha: " + fecha);
	}


	double precioFuncion(String fecha, String sector) {

		for ( Funcion funcion : funciones) {
			if(funcion.fecha.equals(LocalDate.parse(fecha,formatter)))
				if(funcion.sede.getClass().getSimpleName().equals("Teatro")) {
					return funcion.precioBase * (1 + (funcion.sede.porcentajeAdicional(sector)/100));
				}
				else if(funcion.sede.getClass().getSimpleName().equals("miniEstadio")) {
					
					MiniEstadio miniEstadio = (MiniEstadio) funcion.sede;
					return funcion.precioBase + miniEstadio.valorConsumicion (1 + (funcion.sede.porcentajeAdicional(sector)/100)); 
				}
		}
		 throw new RuntimeException("No se encontr贸 funci贸n para la fecha: " + fecha);
	}

	public void agregarEntradaVendida(String sector,String fecha) {
		for ( Funcion funcion : funciones) 
			if(funcion.fecha.equals(LocalDate.parse(fecha,formatter))) {
				funcion.agregarEntradaVendida(sector);

			}

	}

}


